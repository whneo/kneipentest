<?php

/**
 * Description of Kneipe
 *
 * @author sunny
 */
class Kneipe {

    private $id;
    private $kneipenname;
    private $art;
    private $note;
    private $kommentar;

    // Konstruktor
    public function __construct($kneipenname, $art, $note, $kommentar, $id = NULL) {
        $this->kneipenname = $kneipenname;
        $this->art = $art;
        $this->note = $note;
        $this->kommentar = $kommentar;

        if (!is_null($id)) {
            $this->id = $id;
        }
    }

    // Getter
    public function getId() {
        return $this->id;
    }

    public function getKneipenname() {
        return $this->kneipenname;
    }

    public function getArt() {
        return $this->art;
    }

    public function getNote() {
        return $this->note;
    }

    public function getKommentar() {
        return $this->kommentar;
    }

    public static function getAll() {
        $db = DbConnect::getConnection();
        
        $stmt = $db->prepare("SELECT * FROM kneipen");
        $stmt->execute();
        $rows = $stmt->fetchAll(PDO::FETCH_ASSOC);

        $kneipen = [];
        foreach ($rows as $row) {
            $kneipen[] = new Kneipe($row['Kneipenname'], $row['Art'], $row['Note'], $row['Kommentar']);
        }
        return $kneipen;
    }

    public static function insert(Kneipe $kneipe) {
        $db = DbConnect::getConnection();

        $stmt = $db->prepare("INSERT INTO kneipen VALUES (NULL, ?, ?, ?, ?)");
        $stmt->bindValue(1, $kneipe->getKneipenname(), PDO::PARAM_STR);
        $stmt->bindValue(2, $kneipe->getArt(), PDO::PARAM_STR);
        $stmt->bindValue(3, $kneipe->getNote(), PDO::PARAM_INT);
        $stmt->bindValue(4, $kneipe->getKommentar(), PDO::PARAM_STR);
        $stmt->execute();
    }

    public static function getByLikeness($suchstring) {
        $db = DbConnect::getConnection();

        // $suchstring enthÃ¤lt den zu suchenden Teilstring
        // sql statement mit prepared statements
        $stmt = $db->prepare("SELECT * FROM kneipen WHERE Kneipenname LIKE ? or Art LIKE ? or Kommentar LIKE ?");
        $stmt->bindValue(1, "%$suchstring%", PDO::PARAM_STR);
        $stmt->bindValue(2, "%$suchstring%", PDO::PARAM_STR);
        $stmt->bindValue(3, "%$suchstring%", PDO::PARAM_STR);
        $stmt->execute();
        $rows = $stmt->fetchAll(PDO::FETCH_ASSOC);

        $kneipen = [];
        foreach ($rows as $row) {
            $kneipen[] = new Kneipe($row['Kneipenname'], $row['Art'], $row['Note'], $row['Kommentar']);
        }
        return $kneipen;
    }
    
    public static function getNamesByLikeness($term) {
        $db = DbConnect::getConnection();
        
        $stmt = $db->prepare("SELECT Kneipenname FROM kneipen WHERE Kneipenname LIKE ? or Art LIKE ? or Kommentar LIKE ?");
        $stmt->bindValue(1, "%$term%", PDO::PARAM_STR);
        $stmt->bindValue(2, "%$term%", PDO::PARAM_STR);
        $stmt->bindValue(3, "%$term%", PDO::PARAM_STR);
        $stmt->execute();
        $rows = $stmt->fetchAll(PDO::FETCH_OBJ);
        
        $names = [];
        foreach ($rows as $row) {
            $names[] = $row->Kneipenname;
        }
        return $names;
    }

}
